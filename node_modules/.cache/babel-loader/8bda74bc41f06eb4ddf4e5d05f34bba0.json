{"ast":null,"code":"/** PURE_IMPORTS_START tslib,_innerSubscribe PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { SimpleOuterSubscriber, innerSubscribe, SimpleInnerSubscriber } from '../innerSubscribe';\nexport function audit(durationSelector) {\n  return function auditOperatorFunction(source) {\n    return source.lift(new AuditOperator(durationSelector));\n  };\n}\n\nvar AuditOperator = /*@__PURE__*/function () {\n  function AuditOperator(durationSelector) {\n    this.durationSelector = durationSelector;\n  }\n\n  AuditOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new AuditSubscriber(subscriber, this.durationSelector));\n  };\n\n  return AuditOperator;\n}();\n\nvar AuditSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(AuditSubscriber, _super);\n\n  function AuditSubscriber(destination, durationSelector) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.durationSelector = durationSelector;\n    _this.hasValue = false;\n    return _this;\n  }\n\n  AuditSubscriber.prototype._next = function (value) {\n    this.value = value;\n    this.hasValue = true;\n\n    if (!this.throttled) {\n      var duration = void 0;\n\n      try {\n        var durationSelector = this.durationSelector;\n        duration = durationSelector(value);\n      } catch (err) {\n        return this.destination.error(err);\n      }\n\n      var innerSubscription = innerSubscribe(duration, new SimpleInnerSubscriber(this));\n\n      if (!innerSubscription || innerSubscription.closed) {\n        this.clearThrottle();\n      } else {\n        this.add(this.throttled = innerSubscription);\n      }\n    }\n  };\n\n  AuditSubscriber.prototype.clearThrottle = function () {\n    var _a = this,\n        value = _a.value,\n        hasValue = _a.hasValue,\n        throttled = _a.throttled;\n\n    if (throttled) {\n      this.remove(throttled);\n      this.throttled = undefined;\n      throttled.unsubscribe();\n    }\n\n    if (hasValue) {\n      this.value = undefined;\n      this.hasValue = false;\n      this.destination.next(value);\n    }\n  };\n\n  AuditSubscriber.prototype.notifyNext = function () {\n    this.clearThrottle();\n  };\n\n  AuditSubscriber.prototype.notifyComplete = function () {\n    this.clearThrottle();\n  };\n\n  return AuditSubscriber;\n}(SimpleOuterSubscriber);","map":{"version":3,"mappings":";AAKA,OAAO,KAAEA,OAAT,MAAS,OAAT;AAgDA,SAAMC,qBAAN,EAAyBC,cAAzB,EAAmFC,qBAAnF,QAAmF,mBAAnF;OACE,SAAOC,KAAP,CAAgBC,gBAAhB,EAAgB;SACd,SAAOC,qBAAP,CAAuBC,MAAvB,EAAqC;IACrC;EACH;AAED;;IACEC,6BAAoB,YAA0D;WAA1DA;IACnB;EAED;;eACS,WAAOC,OAAU,UAAIC,UAAJ,EAA0BH,MAA1B,EAAsC;IAC/D;EACH;;EAPA,OAOCC,aAPD;AAcA,CAbsB;;IAacG,yCAA2BC,MAA3B,EAA2B;EAM7DZ,mCAAYY,MAAZ;;WAAAD,gBAEEE,aAAMR,kBACP;IAFmB,wBAAgB,IAAhB,kBAA0D,IAA1D;;IAJZS,yBAA0BT,gBAA1B;;IAMP;EAES;;iBACE,WAASU;IACnB,KAAKC,KAAL,GAAaA,KAAb;IACA,KAAKC,QAAL,GAAU,IAAV;;QACE,MAAIC,WAAQ;MACZ,IAAIC,iBAAJ;;UACU;QACR,oBAAW,QAAiBd,gBAA5B;QACDc;MAAC,SACAC,KAAO;QACR;MACD;;MACA,IAAIC,iBAAC,GAAiBnB,cAAI,WAAkB,IAAQC,qBAAR,CAAQ,IAAR,CAAlB,CAA1B;;UACE,sBAAqBkB;QACtB;aACC;QACD;MACF;IACF;EAED;;iBACQ,WAAEC,gBAAO;IACf,IAAIC,SAAJ;IAAA,IAAeP,gBAAf;IAAA,IAAeC,sBAAf;IAAA,IAAeC,wBAAf;;QACEA,WAAW;MACX,KAAKM,MAAL,CAAKN,SAAL;MACA,iBAAUO,SAAV;MACDP;IACD;;QACED,UAAU;MACV,KAAKD,KAAL,GAAaS,SAAb;MACA,KAAKR,QAAL,GAAgB,KAAhB;MACD;IACF;EAED;;iBACO,WAAgBS;IACtB;EAED;;iBACO,WAAgBC;IACtB;EACH;;EApDoC;CAAA","names":["tslib_1","SimpleOuterSubscriber","innerSubscribe","SimpleInnerSubscriber","audit","durationSelector","auditOperatorFunction","source","AuditOperator","call","subscriber","AuditSubscriber","_super","destination","_this","_next","value","hasValue","throttled","duration","err","innerSubscription","clearThrottle","_a","remove","undefined","notifyNext","notifyComplete"],"sources":["../../../src/internal/operators/audit.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}